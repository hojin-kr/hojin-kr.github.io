---
layout: post
title: 쿠버네티스에 대해서
tags: [container,kubernetes]
---
# 쿠버네티스에 대해서

쿠버네티스는 컨테이너를 관리하기 위한 도구입니다. 컨테이너는 어플리케이션의 실행 가능한 형태의 패키지를 의미합니다. 애플리키이션을 컨테이너 패키징하면 경량성, 이식성, 가상화에 대한 용이성을 가지게되고 이러한 특징을 활용해서 자원을 가상화하여 서버 아키텍처를 효율적으로 구성합니다.
쿠버네티스를 사용하면 애플리케이션 하나에 하나의 물리 자원(EC2)를 할당하는것이 아니라, 자원(EC2)에 복수의 어플리케이션을 가상화하여 서비스하거나 Internal 서비스들을 서로 긴밀하게 구성하여 MSA 패턴의 서비스 구조를 구성하는데 유리합니다.
쿠버네티스는 쿠버네티스 yaml 파일로 각 상태를 정의하여 관리합니다. 정의 파일에 대해 패키지로 만들고 관리하는 대표적인 도구가 Helm 차트이며, 배포 정의 파일의 버전을 관리하고 패키징하여 재사용성과 관리 용이성을 높입니다.

### 필요한 것
* 배포할 어플리케이션의 컨테이너 이미지
	* CodeBuild : 클라우드에서 코드를 컨테이너 이미지로 빌드
	* ECR : 컨테이너 이미지를 저장
* 쿠버네티스 시스템을 설치할 컴퓨팅
	* EKS : AWS 관리형 쿠버네티스 시스템
	* Node-Group : EC2 인스턴스의 그룹

# 쿠버네티스란 무엇인가?
컨테이너 오케스트레이션 도구입니다.
쿠버네티스의 기술은 컨테이너 기반의 어플리케이션을 효율적으로 관리하기 위한 기능입니다.

![](/assets/img/5E244AB3-A764-4B0F-A614-671D644486C1.png)

# 구성요소
파드, 서비스, 디플로이먼트, 레플리카셋의 구조를 가집니다.
* 파드 : 어플리케이션 묶음
* 서비스 : 파드의 외부 노출
* 레플리카셋 : 복제본 생성에 대해 관리
* 디플로이먼트 : 구성요소들을 묶은 추상적 개념

![](/assets/img/A0854668-E1EF-41BE-B113-E1619E31D045.png)

# 어떻게 사용하나?
쿠버네티스에 어플리케이션을 배포하고 관리하는 방법은 정의파일을 사용합니다. 어플리케이션의 현재 상태의 정의를 배포함으로써 어플리케이션을 관리합니다.
아래 정의파일의 내용은 nginx 컨테이너 이미지를 Pull 받아 쿠버네티스 시스템에 배포합니다.
SAMPLE
```
apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: nginx
    labels:
  app: nginx
    spec:
      replicas: 3
  selector:
    matchLabels:
     app: nginx
    template:
  metadata:
   labels:
    app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.20.2

```

# 정의 파일에 대한 관리
Helm Chart
정의 파일을 확장성 있게 작성하고 패키징하고 배포하는등 전반적인 쿠버네티스 CD 도구입니다.

# 정의 파일 배포
정의 파일을 쿠버네티스 환경에 적용해서 애플리케이션을 배포합니다.
### 배포 방법
쿠버네티스 컨트롤, 헬름, 아르고CD등 다양한 방식을 사용해서 정의 파일의 배포를 진행할 수 있습니다.

Kubectl 쿠버네티스 컨트롤 명령어를 사용해 완성된 yaml 정의 파일을 apply
````
kubectl apply -f build/deployment.yaml
helm install server build/server
```

ArgoCD argoCD 툴 설치 후 GUI를 활용해서 배포 세팅 argoCD + Helm
helm차트와 argoCD를 조합하여 사용하면 Helm의 Values에 대한 값을 argoCD에서 관리하여 반영할 수 있는 장점을 가지게 됩니다.