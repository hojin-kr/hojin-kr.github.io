---  
layout: post
title: 아임포트 결제 연동하기
gh-repo: daattali/beautiful-jekyll
tags: [pg, import]
comments: true
---

# 아임포트 결제 연동하기

[아임포트 일반결제 연동하기 참고](https://docs.iamport.kr/implementation/payment)

아임포트를 이용한 결제 연동 구현은 프론트엔드에서 이뤄집니다. PG사와의 직접적인 데이터 교환과 로직은 아임포트에서 처리해서 결과만 반환합니다.


## 연동 과정
1. 아임포트 라이브러리 추가
```javascript
//아임포트 라이브러리가 jQuery ^1.0 에 의존성이 있습니다.
jQuery ^1.0, iamport.payment.js
```
2. 객체 초기화 (가맹점 식별코드 삽입)
```javascript
IMP.init("imp가맹점식별코드");
```
3. 결제창 호출
```javascript
//결제 요청 메소드는 결제 요청에 필요한 정보와 결제 호출 후 콜백함수를 정의합니다.
IMP.requeset_pay({
//param
}, function(rsp){
//callback
});
```
4. 결제 요청 결과 서버(자사)에 적용하기
결제 성공, 실패 여부에 따라 자사 서버에 데이터를 전달합니다.
```javascript
//서버사이드에서 거래정보 조회를 위해 imp_ui와 merchant_uid를 서버로 전달합니다.
//서버사이드에서는 해당 데이터를 통해 거래 검증을 진행합니다.
data: {
    imp_uid: rsp.imp_uid,
    merchant_uid: rsp.merchant_uid
}
```
5. 거래 검증 및 거래정보 저장
프론트엔드에서 전달한 imp.uid, merchant_uid를 이용해 서버사이드에서 결제정보를 조회합니다.
조회한 결제정보를 이용해 위변조 여부를 판단하고 거래정보를 DB에 저장합니다.
6. 최종 서버 응답
클라이언트에서 4단계에서 서버사이드로 전달한 데이터 처리 결과에 따라 결제 성공, 실패 여부를 클라이언트에 응답합니다.

## [간편결제] 카카오페이 연동
1. 아임포트 대시보드에서 테스트모드 활성화
![카카오페이테스트모드](https://trello-attachments.s3.amazonaws.com/5db8f4b864493b4c6f0c56bd/5dc232d43113af2f0a839ceb/7537c54a3c4a046e7fbafdc758d117ba/image.png)

2. 


